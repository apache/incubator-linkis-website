# Linkis实践：数据质量方案落地

# 核心思想

```
数据质量的核心就是规则引擎，流式处理只是提供手段，计算过程只存计算逻辑，不存数据
```

# 设计思路

## 前置条件

```
FLINKX只支持一个source流一个sink流处理逻辑 
```

## 解决思路

```
核心：source流—>规则引擎—>sink流
```



## 简化模型

![简单模型](F:\codeOpen\md\简单模型.png)

## 扩展点

- flinkx扩展多个source
- flinkx扩展多个sink
- flinkx扩展数据质量组件

## 复杂模型

![复杂模型](F:\codeOpen\md\复杂模型.png)

# 核心实现(Linkis)

## flinkx引擎引擎

参考文档：

[https://linkis.apache.org/zh-CN/docs/latest/development/new_engine_conn]: 

## 规则引擎支持能力

- 类SQL语法
- 逻辑判断
- 脚本支持
- 错误模板可配置

## 实现流程

![调用逻辑](F:\codeOpen\md\调用逻辑.png)

## 数据质量质检能力

规则引擎提供以上能力，是完全可以覆盖百分之九十左右的业务，以下是规则引擎提供质检能力：

- 空值检查

- 值域检查

- 规范检查

- 逻辑检查

- 波动检查

- 最值检查

- 平衡性检查

- 离群值检查

- 完整性检查

- 自定义JAVA脚本

- *问题数据回溯**（这个是质检规则错误记录表，相当于质检表复制表，只存错误数据，包括质检表原始数据和错误信息），比如：

  质检student表：

  | id   | name     | age  | dept               |
  | ---- | -------- | ---- | ------------------ |
  | 1    | 风清扬   | 99   | 华山派剑宗         |
  | 2    | 令狐老鬼 | 40   | 华山派气宗         |
  | 3    | 向问天   | 45   | 日月神教光明左使   |
  | 4    | 桃李六仙 | 55   | 六兄弟             |
  | 5    | 田伯光   | 45   | 万里独行的采花大盗 |

  质检后错误结果表

  | uuid   | id   | name     | age  | dept               | errinfo                    |
  | ------ | ---- | -------- | ---- | ------------------ | -------------------------- |
  | asads  | 4    | 桃李六仙 | 55   | 六兄弟             | id:4，匹配 id<3,不满足期望 |
  | udasda | 5    | 田伯光   | 45   | 万里独行的采花大盗 | id:5，匹配 id<3,不满足期望 |

## 数据质量流计算缺陷

- 凡是累计数据检查都无法做，比如：重复记录检查。例如：质检一张表中所有重复数据；质检一直表中所有门牌号是否缺失（纵向和横向）等





